{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nvar _util = require('./util');\n\nvar _validator = require('./validator/');\n\nvar _validator2 = _interopRequireDefault(_validator);\n\nvar _messages2 = require('./messages');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    'default': obj\n  };\n}\n/**\r\n *  Encapsulates a validation schema.\r\n *\r\n *  @param descriptor An object declaring validation rules\r\n *  for this schema.\r\n */\n\n\nfunction Schema(descriptor) {\n  this.rules = null;\n  this._messages = _messages2.messages;\n  this.define(descriptor);\n}\n\nSchema.prototype = {\n  messages: function messages(_messages) {\n    if (_messages) {\n      this._messages = (0, _util.deepMerge)((0, _messages2.newMessages)(), _messages);\n    }\n\n    return this._messages;\n  },\n  define: function define(rules) {\n    if (!rules) {\n      throw new Error('Cannot configure a schema with no rules');\n    }\n\n    if ((typeof rules === 'undefined' ? 'undefined' : _typeof(rules)) !== 'object' || Array.isArray(rules)) {\n      throw new Error('Rules must be an object');\n    }\n\n    this.rules = {};\n    var z = void 0;\n    var item = void 0;\n\n    for (z in rules) {\n      if (rules.hasOwnProperty(z)) {\n        item = rules[z];\n        this.rules[z] = Array.isArray(item) ? item : [item];\n      }\n    }\n  },\n  validate: function validate(source_) {\n    var _this = this;\n\n    var o = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var oc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};\n    var source = source_;\n    var options = o;\n    var callback = oc;\n\n    if (typeof options === 'function') {\n      callback = options;\n      options = {};\n    }\n\n    if (!this.rules || Object.keys(this.rules).length === 0) {\n      if (callback) {\n        callback();\n      }\n\n      return Promise.resolve();\n    }\n\n    function complete(results) {\n      var i = void 0;\n      var errors = [];\n      var fields = {};\n\n      function add(e) {\n        if (Array.isArray(e)) {\n          var _errors;\n\n          errors = (_errors = errors).concat.apply(_errors, e);\n        } else {\n          errors.push(e);\n        }\n      }\n\n      for (i = 0; i < results.length; i++) {\n        add(results[i]);\n      }\n\n      if (!errors.length) {\n        errors = null;\n        fields = null;\n      } else {\n        fields = (0, _util.convertFieldsError)(errors);\n      }\n\n      callback(errors, fields);\n    }\n\n    if (options.messages) {\n      var messages = this.messages();\n\n      if (messages === _messages2.messages) {\n        messages = (0, _messages2.newMessages)();\n      }\n\n      (0, _util.deepMerge)(messages, options.messages);\n      options.messages = messages;\n    } else {\n      options.messages = this.messages();\n    }\n\n    var arr = void 0;\n    var value = void 0;\n    var series = {};\n    var keys = options.keys || Object.keys(this.rules);\n    keys.forEach(function (z) {\n      arr = _this.rules[z];\n      value = source[z];\n      arr.forEach(function (r) {\n        var rule = r;\n\n        if (typeof rule.transform === 'function') {\n          if (source === source_) {\n            source = _extends({}, source);\n          }\n\n          value = source[z] = rule.transform(value);\n        }\n\n        if (typeof rule === 'function') {\n          rule = {\n            validator: rule\n          };\n        } else {\n          rule = _extends({}, rule);\n        }\n\n        rule.validator = _this.getValidationMethod(rule);\n        rule.field = z;\n        rule.fullField = rule.fullField || z;\n        rule.type = _this.getType(rule);\n\n        if (!rule.validator) {\n          return;\n        }\n\n        series[z] = series[z] || [];\n        series[z].push({\n          rule: rule,\n          value: value,\n          source: source,\n          field: z\n        });\n      });\n    });\n    var errorFields = {};\n    return (0, _util.asyncMap)(series, options, function (data, doIt) {\n      var rule = data.rule;\n      var deep = (rule.type === 'object' || rule.type === 'array') && (_typeof(rule.fields) === 'object' || _typeof(rule.defaultField) === 'object');\n      deep = deep && (rule.required || !rule.required && data.value);\n      rule.field = data.field;\n\n      function addFullfield(key, schema) {\n        return _extends({}, schema, {\n          fullField: rule.fullField + '.' + key\n        });\n      }\n\n      function cb() {\n        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n        var errors = e;\n\n        if (!Array.isArray(errors)) {\n          errors = [errors];\n        }\n\n        if (!options.suppressWarning && errors.length) {\n          Schema.warning('async-validator:', errors);\n        }\n\n        if (errors.length && rule.message) {\n          errors = [].concat(rule.message);\n        }\n\n        errors = errors.map((0, _util.complementError)(rule));\n\n        if (options.first && errors.length) {\n          errorFields[rule.field] = 1;\n          return doIt(errors);\n        }\n\n        if (!deep) {\n          doIt(errors);\n        } else {\n          // if rule is required but the target object\n          // does not exist fail at the rule level and don't\n          // go deeper\n          if (rule.required && !data.value) {\n            if (rule.message) {\n              errors = [].concat(rule.message).map((0, _util.complementError)(rule));\n            } else if (options.error) {\n              errors = [options.error(rule, (0, _util.format)(options.messages.required, rule.field))];\n            } else {\n              errors = [];\n            }\n\n            return doIt(errors);\n          }\n\n          var fieldsSchema = {};\n\n          if (rule.defaultField) {\n            for (var k in data.value) {\n              if (data.value.hasOwnProperty(k)) {\n                fieldsSchema[k] = rule.defaultField;\n              }\n            }\n          }\n\n          fieldsSchema = _extends({}, fieldsSchema, data.rule.fields);\n\n          for (var f in fieldsSchema) {\n            if (fieldsSchema.hasOwnProperty(f)) {\n              var fieldSchema = Array.isArray(fieldsSchema[f]) ? fieldsSchema[f] : [fieldsSchema[f]];\n              fieldsSchema[f] = fieldSchema.map(addFullfield.bind(null, f));\n            }\n          }\n\n          var schema = new Schema(fieldsSchema);\n          schema.messages(options.messages);\n\n          if (data.rule.options) {\n            data.rule.options.messages = options.messages;\n            data.rule.options.error = options.error;\n          }\n\n          schema.validate(data.value, data.rule.options || options, function (errs) {\n            var finalErrors = [];\n\n            if (errors && errors.length) {\n              finalErrors.push.apply(finalErrors, errors);\n            }\n\n            if (errs && errs.length) {\n              finalErrors.push.apply(finalErrors, errs);\n            }\n\n            doIt(finalErrors.length ? finalErrors : null);\n          });\n        }\n      }\n\n      var res = void 0;\n\n      if (rule.asyncValidator) {\n        res = rule.asyncValidator(rule, data.value, cb, data.source, options);\n      } else if (rule.validator) {\n        res = rule.validator(rule, data.value, cb, data.source, options);\n\n        if (res === true) {\n          cb();\n        } else if (res === false) {\n          cb(rule.message || rule.field + ' fails');\n        } else if (res instanceof Array) {\n          cb(res);\n        } else if (res instanceof Error) {\n          cb(res.message);\n        }\n      }\n\n      if (res && res.then) {\n        res.then(function () {\n          return cb();\n        }, function (e) {\n          return cb(e);\n        });\n      }\n    }, function (results) {\n      complete(results);\n    });\n  },\n  getType: function getType(rule) {\n    if (rule.type === undefined && rule.pattern instanceof RegExp) {\n      rule.type = 'pattern';\n    }\n\n    if (typeof rule.validator !== 'function' && rule.type && !_validator2['default'].hasOwnProperty(rule.type)) {\n      throw new Error((0, _util.format)('Unknown rule type %s', rule.type));\n    }\n\n    return rule.type || 'string';\n  },\n  getValidationMethod: function getValidationMethod(rule) {\n    if (typeof rule.validator === 'function') {\n      return rule.validator;\n    }\n\n    var keys = Object.keys(rule);\n    var messageIndex = keys.indexOf('message');\n\n    if (messageIndex !== -1) {\n      keys.splice(messageIndex, 1);\n    }\n\n    if (keys.length === 1 && keys[0] === 'required') {\n      return _validator2['default'].required;\n    }\n\n    return _validator2['default'][this.getType(rule)] || false;\n  }\n};\n\nSchema.register = function register(type, validator) {\n  if (typeof validator !== 'function') {\n    throw new Error('Cannot register a validator by type, validator is not a function');\n  }\n\n  _validator2['default'][type] = validator;\n};\n\nSchema.warning = _util.warning;\nSchema.messages = _messages2.messages;\nexports['default'] = Schema;","map":{"version":3,"sources":["D:/Exercises/HTML/DOM/Test/node_modules/element-react/node_modules/async-validator/es/index.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_typeof","Symbol","iterator","obj","constructor","_util","require","_validator","_validator2","_interopRequireDefault","_messages2","__esModule","Schema","descriptor","rules","_messages","messages","define","deepMerge","newMessages","Error","Array","isArray","z","item","validate","source_","_this","o","undefined","oc","options","callback","keys","Promise","resolve","complete","results","errors","fields","add","e","_errors","concat","apply","push","convertFieldsError","arr","series","forEach","r","rule","transform","validator","getValidationMethod","field","fullField","type","getType","errorFields","asyncMap","data","doIt","deep","defaultField","required","addFullfield","schema","cb","suppressWarning","warning","message","map","complementError","first","error","format","fieldsSchema","k","f","fieldSchema","bind","errs","finalErrors","res","asyncValidator","then","pattern","RegExp","messageIndex","indexOf","splice","register"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\n\r\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\r\n\r\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\r\nvar _util = require('./util');\r\n\r\nvar _validator = require('./validator/');\r\n\r\nvar _validator2 = _interopRequireDefault(_validator);\r\n\r\nvar _messages2 = require('./messages');\r\n\r\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\r\n\r\n/**\r\n *  Encapsulates a validation schema.\r\n *\r\n *  @param descriptor An object declaring validation rules\r\n *  for this schema.\r\n */\r\nfunction Schema(descriptor) {\r\n  this.rules = null;\r\n  this._messages = _messages2.messages;\r\n  this.define(descriptor);\r\n}\r\n\r\nSchema.prototype = {\r\n  messages: function messages(_messages) {\r\n    if (_messages) {\r\n      this._messages = (0, _util.deepMerge)((0, _messages2.newMessages)(), _messages);\r\n    }\r\n    return this._messages;\r\n  },\r\n  define: function define(rules) {\r\n    if (!rules) {\r\n      throw new Error('Cannot configure a schema with no rules');\r\n    }\r\n    if ((typeof rules === 'undefined' ? 'undefined' : _typeof(rules)) !== 'object' || Array.isArray(rules)) {\r\n      throw new Error('Rules must be an object');\r\n    }\r\n    this.rules = {};\r\n    var z = void 0;\r\n    var item = void 0;\r\n    for (z in rules) {\r\n      if (rules.hasOwnProperty(z)) {\r\n        item = rules[z];\r\n        this.rules[z] = Array.isArray(item) ? item : [item];\r\n      }\r\n    }\r\n  },\r\n  validate: function validate(source_) {\r\n    var _this = this;\r\n\r\n    var o = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n    var oc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};\r\n\r\n    var source = source_;\r\n    var options = o;\r\n    var callback = oc;\r\n    if (typeof options === 'function') {\r\n      callback = options;\r\n      options = {};\r\n    }\r\n    if (!this.rules || Object.keys(this.rules).length === 0) {\r\n      if (callback) {\r\n        callback();\r\n      }\r\n      return Promise.resolve();\r\n    }\r\n\r\n    function complete(results) {\r\n      var i = void 0;\r\n      var errors = [];\r\n      var fields = {};\r\n\r\n      function add(e) {\r\n        if (Array.isArray(e)) {\r\n          var _errors;\r\n\r\n          errors = (_errors = errors).concat.apply(_errors, e);\r\n        } else {\r\n          errors.push(e);\r\n        }\r\n      }\r\n\r\n      for (i = 0; i < results.length; i++) {\r\n        add(results[i]);\r\n      }\r\n      if (!errors.length) {\r\n        errors = null;\r\n        fields = null;\r\n      } else {\r\n        fields = (0, _util.convertFieldsError)(errors);\r\n      }\r\n      callback(errors, fields);\r\n    }\r\n\r\n    if (options.messages) {\r\n      var messages = this.messages();\r\n      if (messages === _messages2.messages) {\r\n        messages = (0, _messages2.newMessages)();\r\n      }\r\n      (0, _util.deepMerge)(messages, options.messages);\r\n      options.messages = messages;\r\n    } else {\r\n      options.messages = this.messages();\r\n    }\r\n    var arr = void 0;\r\n    var value = void 0;\r\n    var series = {};\r\n    var keys = options.keys || Object.keys(this.rules);\r\n    keys.forEach(function (z) {\r\n      arr = _this.rules[z];\r\n      value = source[z];\r\n      arr.forEach(function (r) {\r\n        var rule = r;\r\n        if (typeof rule.transform === 'function') {\r\n          if (source === source_) {\r\n            source = _extends({}, source);\r\n          }\r\n          value = source[z] = rule.transform(value);\r\n        }\r\n        if (typeof rule === 'function') {\r\n          rule = {\r\n            validator: rule\r\n          };\r\n        } else {\r\n          rule = _extends({}, rule);\r\n        }\r\n        rule.validator = _this.getValidationMethod(rule);\r\n        rule.field = z;\r\n        rule.fullField = rule.fullField || z;\r\n        rule.type = _this.getType(rule);\r\n        if (!rule.validator) {\r\n          return;\r\n        }\r\n        series[z] = series[z] || [];\r\n        series[z].push({\r\n          rule: rule,\r\n          value: value,\r\n          source: source,\r\n          field: z\r\n        });\r\n      });\r\n    });\r\n    var errorFields = {};\r\n    return (0, _util.asyncMap)(series, options, function (data, doIt) {\r\n      var rule = data.rule;\r\n      var deep = (rule.type === 'object' || rule.type === 'array') && (_typeof(rule.fields) === 'object' || _typeof(rule.defaultField) === 'object');\r\n      deep = deep && (rule.required || !rule.required && data.value);\r\n      rule.field = data.field;\r\n\r\n      function addFullfield(key, schema) {\r\n        return _extends({}, schema, {\r\n          fullField: rule.fullField + '.' + key\r\n        });\r\n      }\r\n\r\n      function cb() {\r\n        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n\r\n        var errors = e;\r\n        if (!Array.isArray(errors)) {\r\n          errors = [errors];\r\n        }\r\n        if (!options.suppressWarning && errors.length) {\r\n          Schema.warning('async-validator:', errors);\r\n        }\r\n        if (errors.length && rule.message) {\r\n          errors = [].concat(rule.message);\r\n        }\r\n\r\n        errors = errors.map((0, _util.complementError)(rule));\r\n\r\n        if (options.first && errors.length) {\r\n          errorFields[rule.field] = 1;\r\n          return doIt(errors);\r\n        }\r\n        if (!deep) {\r\n          doIt(errors);\r\n        } else {\r\n          // if rule is required but the target object\r\n          // does not exist fail at the rule level and don't\r\n          // go deeper\r\n          if (rule.required && !data.value) {\r\n            if (rule.message) {\r\n              errors = [].concat(rule.message).map((0, _util.complementError)(rule));\r\n            } else if (options.error) {\r\n              errors = [options.error(rule, (0, _util.format)(options.messages.required, rule.field))];\r\n            } else {\r\n              errors = [];\r\n            }\r\n            return doIt(errors);\r\n          }\r\n\r\n          var fieldsSchema = {};\r\n          if (rule.defaultField) {\r\n            for (var k in data.value) {\r\n              if (data.value.hasOwnProperty(k)) {\r\n                fieldsSchema[k] = rule.defaultField;\r\n              }\r\n            }\r\n          }\r\n          fieldsSchema = _extends({}, fieldsSchema, data.rule.fields);\r\n          for (var f in fieldsSchema) {\r\n            if (fieldsSchema.hasOwnProperty(f)) {\r\n              var fieldSchema = Array.isArray(fieldsSchema[f]) ? fieldsSchema[f] : [fieldsSchema[f]];\r\n              fieldsSchema[f] = fieldSchema.map(addFullfield.bind(null, f));\r\n            }\r\n          }\r\n          var schema = new Schema(fieldsSchema);\r\n          schema.messages(options.messages);\r\n          if (data.rule.options) {\r\n            data.rule.options.messages = options.messages;\r\n            data.rule.options.error = options.error;\r\n          }\r\n          schema.validate(data.value, data.rule.options || options, function (errs) {\r\n            var finalErrors = [];\r\n            if (errors && errors.length) {\r\n              finalErrors.push.apply(finalErrors, errors);\r\n            }\r\n            if (errs && errs.length) {\r\n              finalErrors.push.apply(finalErrors, errs);\r\n            }\r\n            doIt(finalErrors.length ? finalErrors : null);\r\n          });\r\n        }\r\n      }\r\n\r\n      var res = void 0;\r\n      if (rule.asyncValidator) {\r\n        res = rule.asyncValidator(rule, data.value, cb, data.source, options);\r\n      } else if (rule.validator) {\r\n        res = rule.validator(rule, data.value, cb, data.source, options);\r\n        if (res === true) {\r\n          cb();\r\n        } else if (res === false) {\r\n          cb(rule.message || rule.field + ' fails');\r\n        } else if (res instanceof Array) {\r\n          cb(res);\r\n        } else if (res instanceof Error) {\r\n          cb(res.message);\r\n        }\r\n      }\r\n      if (res && res.then) {\r\n        res.then(function () {\r\n          return cb();\r\n        }, function (e) {\r\n          return cb(e);\r\n        });\r\n      }\r\n    }, function (results) {\r\n      complete(results);\r\n    });\r\n  },\r\n  getType: function getType(rule) {\r\n    if (rule.type === undefined && rule.pattern instanceof RegExp) {\r\n      rule.type = 'pattern';\r\n    }\r\n    if (typeof rule.validator !== 'function' && rule.type && !_validator2['default'].hasOwnProperty(rule.type)) {\r\n      throw new Error((0, _util.format)('Unknown rule type %s', rule.type));\r\n    }\r\n    return rule.type || 'string';\r\n  },\r\n  getValidationMethod: function getValidationMethod(rule) {\r\n    if (typeof rule.validator === 'function') {\r\n      return rule.validator;\r\n    }\r\n    var keys = Object.keys(rule);\r\n    var messageIndex = keys.indexOf('message');\r\n    if (messageIndex !== -1) {\r\n      keys.splice(messageIndex, 1);\r\n    }\r\n    if (keys.length === 1 && keys[0] === 'required') {\r\n      return _validator2['default'].required;\r\n    }\r\n    return _validator2['default'][this.getType(rule)] || false;\r\n  }\r\n};\r\n\r\nSchema.register = function register(type, validator) {\r\n  if (typeof validator !== 'function') {\r\n    throw new Error('Cannot register a validator by type, validator is not a function');\r\n  }\r\n  _validator2['default'][type] = validator;\r\n};\r\n\r\nSchema.warning = _util.warning;\r\n\r\nSchema.messages = _messages2.messages;\r\n\r\nexports['default'] = Schema;"]},"metadata":{},"sourceType":"script"}